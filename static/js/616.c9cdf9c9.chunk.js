(self.webpackChunkhk_independent_bus_eta=self.webpackChunkhk_independent_bus_eta||[]).push([[616],{421:(e,t,n)=>{"use strict";n.d(t,{D:()=>i,u:()=>l});var o=n(7313),s=n(9176),r=n(5281),a=n(6417);const l=o.forwardRef(((e,t)=>{let{sx:n,color:o,...r}=e;return(0,a.jsx)(s.Z,{color:null!==o&&void 0!==o?o:"inherit",sx:{m:1,height:5,borderRadius:5,...n},ref:t,...r})})),i=o.forwardRef(((e,t)=>{let{sx:n,color:o,...s}=e;return(0,a.jsx)(r.Z,{color:null!==o&&void 0!==o?o:"inherit",sx:{m:1,...n},ref:t,...s})}))},8747:(e,t,n)=>{"use strict";n.d(t,{Z:()=>p});var o=n(5281),s=n(8310),r=n(1660),a=n(7313),l=n(4511),i=n(4395),c=n(6060),u=n(3135);var d=n(6417);const p=e=>{let{stops:t,isFocus:n}=e;const p=(e=>{let{stopKeys:t,disabled:n=!1}=e;const{db:{routeList:o,stopList:s,serviceDayMap:r},isVisible:d,refreshInterval:p,isRouteFilter:x,isTodayHoliday:h}=(0,a.useContext)(c.ZP),g=(0,a.useMemo)((()=>t.reduce(((e,t)=>{let[n]=t;return"lightRail"===n}),!1)),[t]),m=(0,a.useMemo)((()=>Object.entries(o).reduce(((e,n)=>{let[o,{stops:s,freq:a}]=n;return x&&!(0,u.x4)(o,a,h,r)||t.forEach((t=>{var n;let[r,a]=t;null===(n=s[r])||void 0===n||n.forEach(((t,n)=>{t===a&&e.push([o,n])}))})),e}),[]).map((e=>e.join("|"))).filter(((e,t,n)=>n.indexOf(e)===t)).map((e=>e.split("|")))),[t,o,x,h,r]),[f,j]=(0,a.useState)([]),{i18n:{language:b}}=(0,l.$)(),v=(0,a.useRef)(!1),Z=(0,a.useCallback)((()=>!d||n||"prerendering"===navigator.userAgent?(j([]),new Promise((e=>e([])))):Promise.all(m.map((e=>{let[t,n]=e;return(0,i.Gx)({...o[t],seq:parseInt(n,10),stopList:s,language:b})}))).then((e=>{v.current&&j(e.map(((e,t)=>[m[t].join("/"),e.filter((e=>{let{co:n,dest:s}=e;return"mtr"!==n||s.zh===o[m[t][0]].dest.zh}))])).sort(((e,t)=>{let[n,o]=e,[s,r]=t;return 0===o.length?1:0===r.length?-1:g?o[0].remark.zh===r[0].remark.zh?o[0].eta<r[0].eta?-1:1:o[0].remark.zh<r[0].remark.zh?-1:1:o[0].eta===r[0].eta?n<s?-1:1:o[0].eta<r[0].eta?-1:1})))}))),[d,n,b,o,s,m,g]);return(0,a.useEffect)((()=>{v.current=!0;const e=setInterval((()=>{Z()}),p);return Z(),()=>{v.current=!1,clearInterval(e)}}),[Z,p]),f})({stopKeys:t,disabled:!n});return 0===p.length?(0,d.jsx)(o.Z,{sx:{my:5}}):(0,d.jsx)(s.Z,{children:p.map((e=>{let[t,n]=e;return(0,d.jsx)(r.Z,{routeId:t,etas:n},t)}))})}},3310:(e,t,n)=>{"use strict";n.d(t,{Z:()=>h});var o=n(7313),s=n(7829),r=n(1113),a=n(4511),l=n(6060),i=n(9119),c=n(421),u=n(5823),d=n(6417);const p=e=>{let{eta:{eta:t,remark:n,co:i,dest:c},routeDests:u,showCompany:p}=e;const{t:h,i18n:{language:m}}=(0,a.$)(),{etaFormat:f}=(0,o.useContext)(l.ZP),j=(0,o.useMemo)((()=>{for(const e of u){if(e.en.toLowerCase()===c.en.toLowerCase())return!1;if(e.zh===c.zh)return!1}return!0}),[u,c]),b=Math.round((new Date(t).getTime()-(new Date).getTime())/60/1e3),v=(0,d.jsx)(s.Z,{component:"span",sx:"exact"!==f?{fontSize:"0.9em"}:{},children:t.slice(11,16)}),Z=(0,d.jsxs)(s.Z,{component:"span",children:[(0,d.jsx)(s.Z,{component:"span",sx:{...g,color:e=>e.palette.warning.main},children:b<1?" - ":"".concat(b," ")}),(0,d.jsx)(s.Z,{component:"span",sx:{fontSize:"0.8em"},children:h("\u5206\u9418")})]});return(0,d.jsxs)(r.Z,{variant:"subtitle1",children:["diff"===f&&Z,"exact"===f&&v,"mixed"===f&&(0,d.jsxs)(d.Fragment,{children:[v,"\u2003",Z]}),"\u2003-\xa0",(0,d.jsxs)(s.Z,{component:"span",sx:{fontSize:"0.8em",textOverflow:"ellipsis"},children:[p&&(0,d.jsxs)(d.Fragment,{children:["\u2003",h(i)]}),"\u2003",x(n[m],m),"\u2003",j&&c[m]]})]})},x=(e,t)=>{if(null===e)return"";const n=[...e.matchAll("zh"===t?/(\d+)\u865f\u6708\u53f0/g:/Platform (\d+)/g)][0]||[];return 2===n.length&&n[1].length&&(e=u.iw[n[1]]),"zh"===t?e.replace(/\u25ad\u25ad/g,"\u96d9\u5361").replace(/\u25ad/g,"\u55ae\u5361"):e.replace(/\u25ad\u25ad/g,"Duel").replace(/\u25ad/g,"Single")},h=e=>{let{routeId:t,seq:n,containerSx:u,showStopName:x=!1}=e;const{t:h,i18n:{language:g}}=(0,a.$)(),{db:{routeList:m,stopList:f}}=(0,o.useContext)(l.ZP),j=(0,i.e)("".concat(t,"/").concat(n)),b=Object.values(m[t].stops)[0][n],v=(0,o.useMemo)((()=>Object.values(m[t].stops).map((e=>f[e[e.length-1]].name)).concat(m[t].dest)),[m,t,f]);return null==j?(0,d.jsx)(s.Z,{sx:u,children:(0,d.jsx)(c.u,{})}):(0,d.jsxs)(s.Z,{sx:u,children:[x&&(0,d.jsx)(r.Z,{variant:"caption",children:f[b].name[g]}),0===j.length&&h("\u672a\u6709\u73ed\u6b21\u8cc7\u6599"),j.length>0&&j.map(((e,n)=>(0,d.jsx)(p,{eta:e,routeDests:v,showCompany:m[t].co.length>1},"route-".concat(n))))]})},g={fontWeight:"700",color:"#088bce"}},8616:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>Ie});var o=n(7313),s=n(8467),r=n(7912),a=n(501),l=n(1113),i=n(7829),c=n(9530),u=n(5823),d=n(4511),p=n(6060),x=n(9536),h=n(9099),g=n(1171),m=n(6417);const f=(0,g.Z)((0,m.jsx)("path",{d:"m18 12 4-4-4-4v3H3v2h15zM6 12l-4 4 4 4v-3h15v-2H6z"}),"SyncAlt");var j=n(3135);const b=e=>{let{routeId:t}=e;const{t:n,i18n:r}=(0,d.$)(),{db:{routeList:a,holidays:l,stopList:i,serviceDayMap:c},vibrateDuration:g}=(0,o.useContext)(p.ZP),{route:b,stops:C,co:k,gtfsId:y}=a[t],I=(0,s.s0)(),M=(0,o.useMemo)((()=>(0,j.HD)(l,new Date)),[l]),w=(0,o.useMemo)((()=>Object.entries(a).reduce(((e,n)=>{let[o,s]=n;if(o===t)return e;const{co:r,route:a,gtfsId:l}=s;return"gmb"===k[0]&&y&&y!==l?e:a===b&&JSON.stringify(k)===JSON.stringify(r)?[...e,[o,s]]:e}),[]).sort(((e,t)=>{let[,n]=e,[,o]=t;const s=(0,j.x4)(n.route,n.freq,M,c),r=(0,j.x4)(o.route,o.freq,M,c);if(s===r){const e=i[Object.values(C)[0][0]],t=i[Object.values(C)[0].slice(-1)[0]],s=i[Object.values(n.stops)[0][0]],r=i[Object.values(n.stops)[0].slice(-1)[0]],a=(0,u.Sp)(s.location,t.location)+(0,u.Sp)(e.location,r.location),l=i[Object.values(o.stops)[0][0]],c=i[Object.values(o.stops)[0].slice(-1)[0]];return a<(0,u.Sp)(l.location,t.location)+(0,u.Sp)(e.location,c.location)?-1:1}return s>r?-1:1})).map((e=>{let[t]=e;return t})).filter((e=>e.toLowerCase()!==t))),[b,k,y,a,i,M,t,C,c]),z=(0,o.useCallback)((e=>{e.preventDefault(),(0,u.tp)(g),setTimeout((()=>{I("/".concat(r.language,"/route/").concat(w[0].toLowerCase()))}),0)}),[w,I,r.language,g]);return w.length>0&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(x.Z,{orientation:"vertical",sx:v}),(0,m.jsx)(h.Z,{variant:"text","aria-label":"open-timetable",sx:Z,size:"small",startIcon:(0,m.jsx)(f,{}),onClick:z,children:n("\u5c0d\u982d\u7dda")})]})},v={position:"absolute",top:"0",left:"calc(64px + 2%)"},Z={color:e=>e.palette.getContrastText(e.palette.background.default),position:"absolute",top:"0",left:"2%",flexDirection:"column",justifyContent:"center","& > .MuiButton-label":{flexDirection:"column",justifyContent:"center"},"& > .MuiButton-startIcon":{margin:0}};var C=n(736),k=n(7216),y=n(3947),I=n(8310);const M=e=>{let{freq:t,jt:n,open:s,onClose:r}=e;const{t:a}=(0,d.$)(),c=(0,o.useMemo)((()=>Object.entries(t).map((e=>{let[t,n]=e;return(0,m.jsxs)(k.ZP,{sx:S,children:[(0,m.jsx)(l.Z,{variant:"subtitle1",children:a(w[t])}),Object.entries(n).sort(((e,t)=>e[0]<t[0]?-1:1)).map((e=>{let[n,o]=e;return(0,m.jsxs)(i.Z,{sx:P,children:[(0,m.jsxs)(l.Z,{variant:"body1",children:[n," ",o?"- ".concat(o[0]):""]}),o?(0,m.jsxs)(l.Z,{variant:"body1",children:[parseInt(o[1],10)/60,a("\u5206\u9418")]}):(0,m.jsx)(m.Fragment,{})]},"".concat(t,"-").concat(n))}))]},"".concat(t))}))),[t,a]),u=(0,o.useMemo)((()=>({onClose:()=>{r()}})),[r]),p=(0,o.useMemo)((()=>({sx:z})),[]);return(0,m.jsxs)(y.ZP,{open:s,ModalProps:u,PaperProps:p,anchor:"right",children:[n?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(k.ZP,{sx:S,children:(0,m.jsxs)(i.Z,{sx:L,children:[(0,m.jsx)(l.Z,{variant:"subtitle1",children:a("\u8eca\u7a0b")}),(0,m.jsxs)(l.Z,{variant:"subtitle1",children:[Math.round(n),a("\u5206\u9418")]})]})}),(0,m.jsx)(x.Z,{sx:{width:"80%"}})]}):null,(0,m.jsx)(I.Z,{children:c})]})},w={31:"\u661f\u671f\u4e00\u81f3\u4e94",287:"\u661f\u671f\u4e00\u81f3\u4e94",415:"\u661f\u671f\u4e00\u81f3\u4e94",63:"\u661f\u671f\u4e00\u81f3\u516d",319:"\u661f\u671f\u4e00\u81f3\u516d",447:"\u661f\u671f\u4e00\u81f3\u516d",416:"\u661f\u671f\u516d\u81f3\u65e5",480:"\u661f\u671f\u516d\u81f3\u65e5",266:"\u661f\u671f\u4e8c\u81f3\u56db",271:"\u661f\u671f\u4e00\u81f3\u56db",272:"\u661f\u671f\u4e94",288:"\u661f\u671f\u516d",320:"\u661f\u671f\u65e5\u53ca\u516c\u773e\u5047\u671f",448:"\u661f\u671f\u65e5\u53ca\u516c\u773e\u5047\u671f",511:"\u6240\u6709\u65e5\u5b50",111:"\u9664\u661f\u671f\u4e09\u5916",1:"\u661f\u671f\u4e00",2:"\u661f\u671f\u4e8c",4:"\u661f\u671f\u4e09",8:"\u661f\u671f\u56db",16:"\u661f\u671f\u4e94",32:"\u661f\u671f\u516d",64:"\u661f\u671f\u65e5",257:"\u661f\u671f\u4e00",258:"\u661f\u671f\u4e8c",260:"\u661f\u671f\u4e09",264:"\u661f\u671f\u56db",999:"\u672a\u77e5\u65e5\u5b50"},z={height:"100vh",width:"80%",maxWidth:"320px",paddingTop:"56px",paddingLeft:"20px",backgroundColor:e=>"dark"===e.palette.mode?e.palette.background.default:e.palette.primary.main,backgroundImage:"none"},S={flexDirection:"column",alignItems:"flex-start"},L={display:"flex",justifyContent:"space-between",width:"80%"},P={display:"flex",justifyContent:"space-between",width:"80%"},D=e=>{let{routeId:t}=e;const[n,s]=(0,o.useState)(!1),{t:r}=(0,d.$)(),{db:{routeList:a}}=(0,o.useContext)(p.ZP),{freq:l,jt:i}=a[t];return l&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(x.Z,{orientation:"vertical",sx:O}),(0,m.jsx)(h.Z,{variant:"text","aria-label":"open-timetable",sx:F,size:"small",startIcon:(0,m.jsx)(C.Z,{}),onClick:()=>s(!0),children:r("\u6642\u9593\u8868")}),(0,m.jsx)(M,{freq:l,jt:i,open:n,onClose:()=>s(!1)})]})},O={position:"absolute",top:"0",right:"calc(64px + 2%)"},F={color:e=>e.palette.getContrastText(e.palette.background.default),flexDirection:"column",justifyContent:"center","& > .MuiButton-label":{flexDirection:"column",justifyContent:"center"},"& > .MuiButton-startIcon":{margin:0}};var T=n(7131),A=n(6584);const R=(0,g.Z)((0,m.jsx)("path",{d:"m22 9.24-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03L22 9.24zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28L12 15.4z"}),"StarBorderOutlined"),B=e=>{let{routeId:t}=e;const{savedEtas:n,setCollectionDrawerRoute:s}=(0,o.useContext)(p.ZP);return(0,m.jsx)(T.Z,{sx:E,size:"small",onClick:()=>{const e="".concat(t.toUpperCase());s(e)},children:n.includes(t)?(0,m.jsx)(A.Z,{}):(0,m.jsx)(R,{})})},E={color:e=>e.palette.getContrastText(e.palette.background.default),flexDirection:"column",justifyContent:"center","& > .MuiButton-label":{flexDirection:"column",justifyContent:"center"},"& > .MuiButton-startIcon":{margin:0}},$=e=>{let{routeId:t}=e;const{t:n,i18n:s}=(0,d.$)(),{db:{routeList:r}}=(0,o.useContext)(p.ZP),{route:x,orig:h,dest:g,nlbId:f}=r[t];return(0,m.jsxs)(a.Z,{id:"route-eta-header",sx:H,elevation:0,children:[(0,m.jsx)(c.Z,{routeNo:x,component:"h1",align:"center"}),(0,m.jsxs)(l.Z,{component:"h2",variant:"caption",align:"center",children:[n("\u5f80")," ",(0,u.iF)(g[s.language])," ",f?n("\u7531")+" "+(0,u.iF)(h[s.language]):""]}),(0,m.jsx)(b,{routeId:t}),(0,m.jsxs)(i.Z,{sx:q,children:[(0,m.jsx)(B,{routeId:t}),(0,m.jsx)(D,{routeId:t})]})]})},H={textAlign:"center",background:"transparent",position:"relative"},q={position:"absolute",top:"0",right:"2%"};var U=n(3171),V=n(8492),N=n(1872);const _=(0,g.Z)((0,m.jsx)("path",{d:"M20 18.69 7.84 6.14 5.27 3.49 4 4.76l2.8 2.8v.01c-.52.99-.8 2.16-.8 3.42v5l-2 2v1h13.73l2 2L21 19.72l-1-1.03zM12 22c1.11 0 2-.89 2-2h-4c0 1.11.89 2 2 2zm6-7.32V11c0-3.08-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68c-.15.03-.29.08-.42.12-.1.03-.2.07-.3.11h-.01c-.01 0-.01 0-.02.01-.23.09-.46.2-.68.31 0 0-.01 0-.01.01L18 14.68z"}),"NotificationsOff"),W=(0,g.Z)((0,m.jsx)("path",{d:"M10 20h4c0 1.1-.9 2-2 2s-2-.9-2-2zm4-11c0 2.61 1.67 4.83 4 5.66V17h2v2H4v-2h2v-7c0-2.79 1.91-5.14 4.5-5.8v-.7c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5v.7c.71.18 1.36.49 1.95.9C14.54 6.14 14 7.51 14 9zm10-1h-3V5h-2v3h-3v2h3v3h2v-3h3V8z"}),"NotificationAdd"),J=(0,g.Z)((0,m.jsx)("path",{d:"m21.41 10.59-7.99-8c-.78-.78-2.05-.78-2.83 0l-8.01 8c-.78.78-.78 2.05 0 2.83l8.01 8c.78.78 2.05.78 2.83 0l7.99-8c.79-.79.79-2.05 0-2.83zM13.5 14.5V12H10v3H8v-4c0-.55.45-1 1-1h4.5V7.5L17 11l-3.5 3.5z"}),"Directions");var K=n(8989);const G=(0,g.Z)((0,m.jsx)("path",{d:"m22 9.24-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03L22 9.24zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28L12 15.4z"}),"StarBorder");var Y=n(3310),Q=n(6845),X=n(1318),ee=n(4345);const te=o.forwardRef(((e,t)=>{const{routeId:n,stopId:s,stopIdx:r,idx:a,onShareClick:c,onSummaryClick:x,onStopInfoClick:h}=e,{db:{routeList:g,stopList:f},savedEtas:j,setCollectionDrawerRoute:b,collections:v}=(0,o.useContext)(p.ZP),{alarmStopId:Z,toggleStopAlarm:C}=(0,o.useContext)(ee.Z),{isStopAlarm:k}=(0,o.useContext)(ee.Z),{os:y}=(0,o.useContext)(ee.Z),{t:I,i18n:M}=(0,d.$)(),{fares:w,faresHoliday:z}=g[n],S=f[s],L=(0,o.useMemo)((()=>j.includes("".concat(n.toUpperCase(),"/").concat(a))||v.reduce(((e,t)=>e||t.list.includes("".concat(n.toUpperCase(),"/").concat(a))),!1)),[j,v,n,a]),P=(0,o.useCallback)((e=>{c({routeId:n,seq:a,stopId:s,event:e})}),[c,n,a,s]),D=(0,o.useCallback)((e=>{const t="ios"===y||/iPad|iPhone|iPod|Mac/.test(navigator.userAgent),o="https://".concat(t?"watch":"wear",".hkbus.app/route/").concat(n.toLowerCase(),"/").concat(s,"%2C").concat(a);window.open(o,"_blank")}),[n,a,s,y]),O=(0,o.useCallback)(((e,t)=>{x(a,t)}),[a,x]),F=(0,o.useCallback)((()=>{const{lat:e,lng:t}=S.location;window.open("https://www.google.com/maps/dir/?api=1&destination=".concat(e,",").concat(t,"&travelmode=walking"))}),[S.location]);return(0,m.jsxs)(U.Z,{id:"stop-".concat(a),expanded:r===a&&"prerendering"!==navigator.userAgent,onChange:O,TransitionProps:{unmountOnExit:!0},ref:t,sx:ne,children:[(0,m.jsxs)(V.Z,{sx:oe,children:[(0,m.jsxs)(l.Z,{component:"h3",variant:"body1",sx:{fontWeight:700},children:[a+1,". ",(0,u.iF)(S.name[M.language])]}),(0,m.jsxs)(l.Z,{variant:"body2",children:[w&&w[a]?I("\u8eca\u8cbb")+": $"+w[a]:"",z&&z[a]?"\u3000\u3000\u3000\u3000"+I("\u5047\u65e5\u8eca\u8cbb")+": $"+z[a]:""]})]}),(0,m.jsxs)(N.Z,{sx:se,children:[(0,m.jsx)(Y.Z,{containerSx:re,routeId:"".concat(n.toUpperCase()),seq:a}),(0,m.jsxs)(i.Z,{display:"flex",flexDirection:"column",alignItems:"flex-end",children:[(0,m.jsxs)(i.Z,{children:[k&&(0,m.jsx)(T.Z,{"aria-label":"alert",onClick:()=>C(s),style:{backgroundColor:"transparent"},size:"large",children:Z===s?(0,m.jsx)(_,{}):(0,m.jsx)(W,{})}),(0,m.jsx)(T.Z,{"aria-label":"direction",onClick:F,style:{background:"transparent"},size:"large",children:(0,m.jsx)(J,{})}),(0,m.jsx)(T.Z,{"aria-label":"stop-info",onClick:h,style:{background:"transparent"},size:"large",children:(0,m.jsx)(K.Z,{})})]}),(0,m.jsxs)(i.Z,{children:[(0,m.jsx)(T.Z,{"aria-label":"open-on-watch",onClick:D,style:{backgroundColor:"transparent"},size:"large",children:(0,m.jsx)(X.Z,{})}),(0,m.jsx)(T.Z,{"aria-label":"share",onClick:P,style:{backgroundColor:"transparent"},size:"large",children:(0,m.jsx)(Q.Z,{})}),(0,m.jsx)(T.Z,{"aria-label":"favourite",onClick:()=>{const e="".concat(n.toUpperCase(),"/").concat(a);b(e)},style:{backgroundColor:"transparent"},size:"large",children:L?(0,m.jsx)(A.Z,{sx:ae}):(0,m.jsx)(G,{})})]})]})]})]})})),ne={border:"1px solid rgba(0, 0, 0, .125)",boxShadow:"none","&:not(:last-child)":{borderBottom:0},"&:before":{display:"none"},"&.Mui-expanded":{margin:"auto"}},oe={backgroundColor:e=>"dark"===e.palette.mode?e.palette.background.default:"rgba(0, 0, 0, .03)","&.Mui-expanded":{borderBottom:"1px solid rgba(0, 0, 0, .125)",minHeight:44},minHeight:44,"& .MuiAccordionSummary-content":{margin:"8px 0",flexDirection:"column","&.Mui-expanded":{margin:"8px 0"}}},se={display:"flex",alignItems:"center",pl:2,pr:1,py:1,justifyContent:"space-between"},re={flex:1},ae={color:e=>"dark"===e.palette.mode?e.palette.primary.main:"inherit"},le=(0,r.ZP)((()=>Promise.all([n.e(422),n.e(776)]).then(n.bind(n,6776)))),ie=e=>{let{routeId:t,stopIdx:n,stopIds:s,handleChange:r,onStopInfo:a}=e;const[l,c]=(0,o.useState)(null),u=(0,o.useRef)([]);return(0,o.useEffect)((()=>{if(u.current[n]){const e=setTimeout((()=>{var e;null===(e=u.current[n])||void 0===e||e.scrollIntoView({behavior:"smooth",block:"center"})}),50);return()=>{clearTimeout(e)}}}),[n]),(0,m.jsxs)(i.Z,{sx:ce,children:[s.map(((e,o)=>(0,m.jsx)(te,{routeId:t,stopId:e,stopIdx:n,idx:o,onShareClick:e=>c(e),onSummaryClick:r,onStopInfoClick:a,ref:e=>u.current[o]=e},"stop-"+o))),l&&(0,m.jsx)(le,{...l})]})},ce={overflowY:"scroll"};var ue=n(7943),de=n(3795),pe=n(4469),xe=n(3604),he=n(6467),ge=n(8747);const me=e=>{var t;let{open:n,stops:s,onClose:r}=e;const{db:{stopList:a},savedStops:l,updateSavedStops:i}=(0,o.useContext)(p.ZP),{i18n:c}=(0,d.$)(),u=(0,o.useMemo)((()=>s.reduce(((e,t)=>e||l.includes(t.join("|"))),!1)),[s,l]);return(0,m.jsxs)(pe.Z,{open:n,onClose:r,sx:fe,children:[(0,m.jsxs)(xe.Z,{sx:je,children:[(0,m.jsx)(T.Z,{onClick:()=>i(s[0].join("|")),children:u?(0,m.jsx)(ue.Z,{}):(0,m.jsx)(de.Z,{})}),null===(t=a[s[0][1]])||void 0===t?void 0:t.name[c.language]]}),(0,m.jsx)(he.Z,{children:(0,m.jsx)(ge.Z,{stops:s,isFocus:!0})})]})},fe={"& .MuiPaper-root":{width:"100%",marginTop:"90px",height:"calc(100vh - 100px)"},"& .MuiDialogContent-root":{padding:0}},je={backgroundColor:e=>"dark"===e.palette.mode?e.palette.background.default:e.palette.primary.main,color:e=>"dark"===e.palette.mode?e.palette.primary.main:e.palette.text.primary};var be=n(5875),ve=n.n(be);const Ze=(0,r.ZP)((()=>Promise.all([n.e(443),n.e(933)]).then(n.bind(n,933)))),Ce=(e,t)=>{if(void 0!==t[e])return e;const n=e.split("-")[0];return ve().findBestMatch(e.toUpperCase(),Object.keys(t).filter((e=>e.startsWith(n)))).bestMatch.target},ke=(e,t)=>{for(let n=0;n<e.length;++n)if(e[n]in t)return t[e[n]];return[]},ye=(e,t,n,o)=>{for(let r=0;r<e.length;++r){var s;if(e[r]in t)return[[e[r],t[e[r]][o]]].concat(null!==(s=n[t[e[r]][o]])&&void 0!==s?s:[])}return[]},Ie=()=>{const{id:e,panel:t}=(0,s.UO)(),{AppTitle:n,db:{routeList:r,stopList:a,stopMap:l},updateSelectedRoute:i,energyMode:c,geoPermission:x,geolocation:h}=(0,o.useContext)(p.ZP),g=Ce(e.toUpperCase(),r),f=r[g],{route:j,stops:b,co:v,orig:Z,dest:C,fares:k}=f,y=(0,o.useMemo)((()=>ke(v,b).map((e=>[e,a[e]])).filter((e=>{let[,t]=e;return null!==t&&void 0!==t})).map((e=>{let[t]=e;return t}))),[v,a,b]),[I]=(0,o.useState)((()=>{if("granted"===x){const e=y.map(((e,t)=>[t,(0,u.Sp)(h,a[e].location)])).sort(((e,t)=>e[1]-t[1]))[0];if(e.length>0)return e[0]}return 0})),M=(0,o.useMemo)((()=>{if(void 0!==t){const[e,n]=t.split(",");if(void 0===e||void 0===n)return parseInt(t,10);{const t=parseInt(n,10);let o=0,s=9999999;for(let n in b){let r=b[n].reduce(((t,n,o)=>(n===e&&t.push(o),t)),[]);for(let e of r)if(e>=0){let n=Math.abs(e-t);n<s&&(o=e,s=n)}}return o}}return I}),[t,b,I]),[w,z]=(0,o.useState)(!1),S=(0,o.useMemo)((()=>ye(v,b,l,M)),[v,M,l,b]),{t:L,i18n:P}=(0,d.$)(),D=(0,s.s0)(),O=(0,o.useCallback)(((t,n)=>{if(n&&M!==t){let n=b[Object.keys(b).sort()[0]][t];D("/".concat(P.language,"/route/").concat(e,"/").concat(n,"%2C").concat(t),{replace:!0})}M!==t||n||z(!0)}),[D,P.language,e,M,b]),F=(0,o.useCallback)((t=>{M===t&&z(!0),D("/".concat(P.language,"/route/").concat(e,"/").concat(t),{replace:!0})}),[D,P.language,e,M]),T=(0,o.useCallback)((()=>{z(!0)}),[z]),A=(0,o.useCallback)((()=>{z(!1)}),[z]);return(0,o.useEffect)((()=>{z(!1),document.getElementById(e).setAttribute("value",e),i(e)}),[e,i]),(0,o.useEffect)((()=>{e.toUpperCase()!==g.toUpperCase()&&(console.log(e,g),D("/".concat(P.language,"/route/").concat(g.toLowerCase())))}),[e,g,P.language,D]),(0,o.useEffect)((()=>{(0,u.ND)({title:j+" "+L("\u5f80")+" "+(0,u.iF)(C[P.language])+" - "+L(n),description:(()=>{const e=k?k.filter(((e,t,n)=>n.indexOf(e)===t)).map((e=>"$".concat(e))):[];return"zh"===P.language?"\u8def\u7dda".concat(j)+"\u7531".concat(Z.zh,"\u51fa\u767c\uff0c\u4ee5").concat(C.zh,"\u70ba\u7d42\u9ede\uff0c")+(e.length?"\u5206\u6bb5\u8eca\u8cbb\u70ba".concat(e.join("\u3001"),"\uff0c"):"")+"\u9014\u7d93".concat(y.map((e=>a[e].name.zh)).join("\u3001"),"\u3002"):"Route ".concat(j," ")+"is from ".concat((0,u.iF)(Z.en)," to ").concat((0,u.iF)(C.en))+(e.length?", section fees are ".concat(e.join(", "),". "):". ")+"Stops: "+(0,u.iF)(y.map((e=>a[e].name.en)).join(", "))+". "})(),lang:P.language})}),[n,C,k,P.language,Z.en,Z.zh,j,a,y,L]),(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("input",{hidden:!0,id:e}),(0,m.jsx)($,{routeId:g}),!c&&"prerendering"!==navigator.userAgent&&(0,m.jsx)(Ze,{routeId:g,stopIds:y,stopIdx:M,companies:v,onMarkerClick:F}),(0,m.jsx)(ie,{routeId:g,stopIdx:M,routeListEntry:f,stopIds:y,handleChange:O,onStopInfo:T}),(0,m.jsx)(me,{open:w,stops:S,onClose:A})]})}},6845:(e,t,n)=>{"use strict";var o=n(4836);t.Z=void 0;var s=o(n(5045)),r=n(6417),a=(0,s.default)((0,r.jsx)("path",{d:"M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"}),"Share");t.Z=a},1318:(e,t,n)=>{"use strict";var o=n(4836);t.Z=void 0;var s=o(n(5045)),r=n(6417),a=(0,s.default)((0,r.jsx)("path",{d:"M20 12c0-2.54-1.19-4.81-3.04-6.27L16 0H8l-.95 5.73C5.19 7.19 4 9.45 4 12s1.19 4.81 3.05 6.27L8 24h8l.96-5.73C18.81 16.81 20 14.54 20 12zM6 12c0-3.31 2.69-6 6-6s6 2.69 6 6-2.69 6-6 6-6-2.69-6-6z"}),"Watch");t.Z=a},8989:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var o=n(1171),s=n(6417);const r=(0,o.Z)((0,s.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"}),"Info")},6584:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var o=n(1171),s=n(6417);const r=(0,o.Z)((0,s.jsx)("path",{d:"M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"}),"Star")},3604:(e,t,n)=>{"use strict";n.d(t,{Z:()=>x});var o=n(7313),s=n(3061),r=n(1921),a=n(1113),l=n(7592),i=n(7342),c=n(3174),u=n(3909),d=n(6417);const p=(0,l.ZP)(a.Z,{name:"MuiDialogTitle",slot:"Root",overridesResolver:(e,t)=>t.root})({padding:"16px 24px",flex:"0 0 auto"}),x=o.forwardRef((function(e,t){const n=(0,i.Z)({props:e,name:"MuiDialogTitle"}),{className:a,id:l,...x}=n,h=n,g=(e=>{const{classes:t}=e;return(0,r.Z)({root:["root"]},c.a,t)})(h),{titleId:m=l}=o.useContext(u.Z);return(0,d.jsx)(p,{component:"h2",className:(0,s.Z)(g.root,a),ownerState:h,ref:t,variant:"h6",id:null!=l?l:m,...x})}))},5875:e=>{function t(e,t){if((e=e.replace(/\s+/g,""))===(t=t.replace(/\s+/g,"")))return 1;if(e.length<2||t.length<2)return 0;let n=new Map;for(let s=0;s<e.length-1;s++){const t=e.substring(s,s+2),o=n.has(t)?n.get(t)+1:1;n.set(t,o)}let o=0;for(let s=0;s<t.length-1;s++){const e=t.substring(s,s+2),r=n.has(e)?n.get(e):0;r>0&&(n.set(e,r-1),o++)}return 2*o/(e.length+t.length-2)}e.exports={compareTwoStrings:t,findBestMatch:function(e,n){if(!function(e,t){return"string"===typeof e&&(!!Array.isArray(t)&&(!!t.length&&!t.find((function(e){return"string"!==typeof e}))))}(e,n))throw new Error("Bad arguments: First argument should be a string, second should be an array of strings");const o=[];let s=0;for(let a=0;a<n.length;a++){const r=n[a],l=t(e,r);o.push({target:r,rating:l}),l>o[s].rating&&(s=a)}const r=o[s];return{ratings:o,bestMatch:r,bestMatchIndex:s}}}}}]);